<p-toast position="top-right" key="tr" />

@if (visible) {
<p-accordion-panel value="2">
  <p-accordion-header>
    EXÁMENES DE LABORATORIO DURANTE EL CONTROL PRENATAL
  </p-accordion-header>
  <p-accordion-content>
    <form class="examenes-lab-grid">
      <div></div>
      <div class="flex flex-col gap-1 min-h-[56px] alinear-fecha-registro">
        <div class="flex items-center gap-2">
          <label class="font-bold">Fecha registro: </label>
          <p-datepicker [(ngModel)]="fechaRegistroLab" name="fechaRegistroLab"
            [iconDisplay]="'input'" [showIcon]="true" dateFormat="dd/mm/yy" required></p-datepicker>
        </div>
        <small class="error-message" *ngIf="formErrors['fechaRegistroLab']">
          {{ formErrors['fechaRegistroLab'] }}
        </small>
      </div>
      <div></div>

      <div class="flex flex-col gap-1 min-h-[56px] radios-texto">
        <div class="flex items-center gap-4">
          <label class="font-bold w-24">VDRL </label>
          <p-radioButton name="vdrl" value="1" [(ngModel)]="vdrl"
            inputId="vdrlPos"></p-radioButton>
          <label for="vdrlPos">Positivo</label>
          <p-radioButton name="vdrl" value="0" [(ngModel)]="vdrl"
            inputId="vdrlNeg"></p-radioButton>
          <label for="vdrlNeg">Negativo</label>
        </div>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px]">
        <div class="flex items-center gap-2">
          <label>Fecha de vencimiento: </label>
          <p-datepicker [(ngModel)]="fechaVencimientoVdrl"
            name="fechaVencimientoVdrl" [iconDisplay]="'input'" [showIcon]="true" dateFormat="dd/mm/yy"></p-datepicker>
        </div>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px] archivo-col relative">

        <div class="flex items-center gap-2">
          <label class="font-bold">Examen VDRL </label>
          @if (docVdrl) {
          <span class="nombre-archivo" [title]="fileNames.vdrl">
            {{ fileNames.vdrl || 'Sin archivo' }}
          </span>
          <p-button label="Ver" (onClick)="downloadPDF(0)" severity="secondary" class="ml-2"
            [disabled]="uploading['vdrl']"></p-button>
          }
          @else {
          <p-fileUpload #fuVdrl [auto]="false" [customUpload]="true" [showUploadButton]="false"
            [showCancelButton]="false" chooseLabel="Elegir" name="examenVdrl" (onSelect)="onFileSelect($event, 'vdrl')"
            [maxFileSize]="1000000" [accept]="'.pdf,.jpg,.png'" styleClass="p-0" [styleClass]="'custom-file-upload'"
            [style]="{'border': 'none'}" chooseStyleClass="p-button-blue-custom"></p-fileUpload>
          <span class="nombre-archivo" [title]="fileNames.vdrl">
            {{ fileNames.vdrl || 'Sin archivo' }}
          </span>
          <p-button label="Subir" (onClick)="onUpload('vdrl')" severity="secondary" class="ml-2"
            [disabled]="uploading['vdrl']"></p-button>
          }
        </div>
        @if (uploading['vdrl']) {
        <div class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10">
          <p-progressSpinner strokeWidth="4" [style]="{ width: '35px', height: '35px' }"></p-progressSpinner>
        </div>
        }
      </div>

      <div class="flex flex-col gap-1 min-h-[56px] radios-texto">
        <div class="flex items-center gap-4">
          <label class="font-bold w-24">HbsAg </label>
          <p-radioButton name="hbsag" value="1" [(ngModel)]="hbsag"
            inputId="hbsagPos"></p-radioButton>
          <label for="hbsagPos">Positivo</label>
          <p-radioButton name="hbsag" value="0" [(ngModel)]="hbsag"
            inputId="hbsagNeg"></p-radioButton>
          <label for="hbsagNeg">Negativo</label>
        </div>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px]">
        <div class="flex items-center gap-2">
          <label>Fecha de vencimiento: </label>
          <p-datepicker [(ngModel)]="fechaVencimientoHbsag"
            name="fechaVencimientoHbsag" [iconDisplay]="'input'" [showIcon]="true" dateFormat="dd/mm/yy"></p-datepicker>
        </div>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px] archivo-col relative">
        <div class="flex items-center gap-2">
          <label class="font-bold">Examen HbsAg </label>
          @if (docHbsag) {
          <span class="nombre-archivo" [title]="fileNames.hbsag">
            {{ fileNames.hbsag || 'Sin archivo' }}
          </span>
          <p-button label="Ver" (onClick)="downloadPDF(1)" severity="secondary" class="ml-2"
            [disabled]="uploading['hbsag']"></p-button>
          }
          @else {
          <p-fileUpload #fuHbsag [auto]="false" [customUpload]="true" [showUploadButton]="false"
            [showCancelButton]="false" chooseLabel="Elegir" name="examenHbsag"
            (onSelect)="onFileSelect($event, 'hbsag')" [maxFileSize]="1000000" [accept]="'.pdf,.jpg,.png'"
            styleClass="p-0 custom-file-upload" [style]="{'border': 'none'}"
            chooseStyleClass="p-button-blue-custom"></p-fileUpload>
          <span class="nombre-archivo" [title]="fileNames.hbsag">
            {{ fileNames.hbsag || 'Sin archivo' }}
          </span>
          <p-button label="Subir" (onClick)="onUpload('hbsag')" severity="secondary" class="ml-2"
            [disabled]="uploading['hbsag']"></p-button>
          }
        </div>
        @if (uploading['hbsag']) {
        <div class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10">
          <p-progressSpinner strokeWidth="4" [style]="{ width: '35px', height: '35px' }"></p-progressSpinner>
        </div>
        }
      </div>

      <div class="flex flex-col gap-1 min-h-[56px] radios-texto">
        <div class="flex items-center gap-4">
          <label class="font-bold w-24">HIV </label>
          <p-radioButton name="hiv" value="1" [(ngModel)]="hiv"
            inputId="hivPos"></p-radioButton>
          <label for="hivPos">Positivo</label>
          <p-radioButton name="hiv" value="0" [(ngModel)]="hiv"
            inputId="hivNeg"></p-radioButton>
          <label for="hivNeg">Negativo</label>
        </div>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px]">
        <div class="flex items-center gap-2">
          <label>Fecha de vencimiento: </label>
          <p-datepicker [(ngModel)]="fechaVencimientoHiv"
            name="fechaVencimientoHiv" [iconDisplay]="'input'" [showIcon]="true" dateFormat="dd/mm/yy"></p-datepicker>
        </div>
        <small class="error-message" *ngIf="formErrors['fechaVencimientoHiv']">
          {{ formErrors['fechaVencimientoHiv'] }}
        </small>
      </div>

      <div class="flex flex-col gap-1 min-h-[56px] archivo-col relative">
        <div class="flex items-center gap-2">
          <label class="font-bold">Examen HIV </label>
          @if (docHiv) {
          <span class="nombre-archivo" [title]="fileNames.hiv">
            {{ fileNames.hiv || 'Sin archivo' }}
          </span>
          <p-button label="Ver" (onClick)="downloadPDF(2)" severity="secondary" class="ml-2"
            [disabled]="uploading['hiv']"></p-button>
          }
          @else {
          <p-fileUpload #fuHiv [auto]="false" [customUpload]="true" [showUploadButton]="false"
            [showCancelButton]="false" chooseLabel="Elegir" name="examenHiv" (onSelect)="onFileSelect($event, 'hiv')"
            [maxFileSize]="1000000" [accept]="'.pdf,.jpg,.png'" styleClass="p-0 custom-file-upload"
            [style]="{'border': 'none'}" chooseStyleClass="p-button-blue-custom"></p-fileUpload>
          <span class="nombre-archivo" [title]="fileNames.hiv">
            {{ fileNames.hiv || 'Sin archivo' }}
          </span>
          <p-button label="Subir" (onClick)="onUpload('hiv')" severity="secondary" class="ml-2"
            [disabled]="uploading['hiv']"></p-button>
          }
        </div>

        @if (uploading['hiv']) {
        <div class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center z-10">
          <p-progressSpinner strokeWidth="4" [style]="{ width: '35px', height: '35px' }"></p-progressSpinner>
        </div>
        }
      </div>

      <div class="col-span-3 grid grid-cols-2 gap-8 min-h-[56px]">
        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2">
            <label class="font-bold">HEMOGLOBINA <span class="required">*</span></label>
            <input pInputText type="text" class="w-48"
              [(ngModel)]="hemoglobina" name="hemoglobina" required
              (ngModelChange)="onFieldChange('hemoglobina', $event)" [class.ng-invalid]="formErrors['hemoglobina']" />
            <span>Gr/dl</span>
          </div>
          <small class="error-message" *ngIf="formErrors['hemoglobina']">
            {{ formErrors['hemoglobina'] }}
          </small>
        </div>

        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2">
            <label class="font-bold">HEMATOCRITO <span class="required">*</span></label>
            <input pInputText type="text" class="w-48"
              [(ngModel)]="hematocrito" name="hematocrito" required
              (ngModelChange)="onFieldChange('hematocrito', $event)" [class.ng-invalid]="formErrors['hematocrito']" />
            <span>%</span>
          </div>
          <small class="error-message" *ngIf="formErrors['hematocrito']">
            {{ formErrors['hematocrito'] }}
          </small>
        </div>
      </div>

      <div class="col-span-3 flex flex-col gap-0.5 min-h-[56px] radios-texto">
        <div class="flex items-center gap-4">
          <label class="font-bold">¿Ha recibido transfusiones sanguíneas o se ha hecho tatuajes en el último año? <span
              class="required">*</span></label>
          <p-radioButton name="transfusiones" [value]="1"
            [(ngModel)]="transfusiones" inputId="transfSi"
            (ngModelChange)="onFieldChange('transfusiones', $event)"></p-radioButton>
          <label for="transfSi">Sí</label>
          <p-radioButton name="transfusiones" [value]="0"
            [(ngModel)]="transfusiones" inputId="transfNo"
            (ngModelChange)="onFieldChange('transfusiones', $event)"></p-radioButton>
          <label for="transfNo">No</label>
        </div>
        <small class="error-message" *ngIf="formErrors['transfusiones']">
          {{ formErrors['transfusiones'] }}
        </small>
      </div>

      <div class="col-span-3 flex flex-col gap-1 min-h-[56px]">
        <div class="flex items-center gap-4">
          <label class="font-bold">¿Qué enfermedades presentó durante la gestación? <span
              class="required">*</span></label>
          <input pInputText type="text" class="flex-1"
            [(ngModel)]="enfermedadesGestacion"
            name="enfermedadesGestacion" required (ngModelChange)="onFieldChange('enfermedadesGestacion', $event)"
            [class.ng-invalid]="formErrors['enfermedadesGestacion']" />
        </div>
        <small class="error-message" *ngIf="formErrors['enfermedadesGestacion']">
          {{ formErrors['enfermedadesGestacion'] }}
        </small>
      </div>

      <div class="col-span-3 grid grid-cols-2 gap-8 min-h-[56px] fuma-alcohol-section">
        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2 radios-texto">
            <label class="font-bold">Fuma: <span class="required">*</span></label>
            <p-radioButton name="fuma" [value]="1" [(ngModel)]="fuma"
              inputId="fumaSi" (ngModelChange)="onFieldChange('fuma', $event)"></p-radioButton>
            <label for="fumaSi">Sí</label>
            <p-radioButton name="fuma" [value]="0" [(ngModel)]="fuma"
              inputId="fumaNo" (ngModelChange)="onFieldChange('fuma', $event)"></p-radioButton>
            <label for="fumaNo">No</label>
          </div>
          <small class="error-message" *ngIf="formErrors['fuma']">
            {{ formErrors['fuma'] }}
          </small>
        </div>

        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2 radios-texto">
            <label class="font-bold">Consume Alcohol: <span class="required">*</span></label>
            <p-radioButton name="alcohol" [value]="1"
              [(ngModel)]="alcohol" inputId="alcoholSi"
              (ngModelChange)="onFieldChange('alcohol', $event)"></p-radioButton>
            <label for="alcoholSi">Sí</label>
            <p-radioButton name="alcohol" [value]="0"
              [(ngModel)]="alcohol" inputId="alcoholNo"
              (ngModelChange)="onFieldChange('alcohol', $event)"></p-radioButton>
            <label for="alcoholNo">No</label>
          </div>
          <small class="error-message" *ngIf="formErrors['alcohol']">
            {{ formErrors['alcohol'] }}
          </small>
        </div>
      </div>
    </form>
  </p-accordion-content>
</p-accordion-panel>
}