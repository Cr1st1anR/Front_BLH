<p-toast position="top-right" key="tr" />

@if (loading) {
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300">
  <p-progress-spinner strokeWidth="8" fill="transparent" animationDuration="2s"
    [style]="{ width: '70px', height: '70px' }"></p-progress-spinner>
</div>
}

<div class="flex flex-col items-center justify-center mx-auto my-6 max-w-full overflow-x-auto">
  <p-table #tableCalentamiento [value]="dataCalentamiento" [scrollable]="true" scrollHeight="400px"
    [columns]="headersCalentamiento" [tableStyle]="{ 'min-width': '80rem' }" dataKey="id" editMode="row">

    <ng-template #header let-columns>
      <!-- Fila de encabezado principal - OPCIÃ“N 1 -->
      <tr>
        <th [attr.colspan]="columns.length" class="text-center header-tiempo-lectura">
          TIEMPO DE LECTURA (MIN)
        </th>
      </tr>
      <!-- Fila de encabezados de columnas -->
      <tr>
        @for (col of columns; track $index) {
        <th class="grid-lines text-center">{{ col.header }}</th>
        }
      </tr>
    </ng-template>

    <ng-template #body let-rowData let-columns="columns" let-editing="editing" let-rowIndex="rowIndex">
      <tr [pEditableRow]="rowData">
        @for (col of columns; track $index) {
        <td class="text-center">
          @if (col.field === 'temp_0') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_0" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_0 !== null && rowData.temp_0 !== undefined ? rowData.temp_0 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_5') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_5" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_5 !== null && rowData.temp_5 !== undefined ? rowData.temp_5 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_10') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_10" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_10 !== null && rowData.temp_10 !== undefined ? rowData.temp_10 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_15') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_15" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_15 !== null && rowData.temp_15 !== undefined ? rowData.temp_15 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_20') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_20" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_20 !== null && rowData.temp_20 !== undefined ? rowData.temp_20 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_25') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_25" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_25 !== null && rowData.temp_25 !== undefined ? rowData.temp_25 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_30') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_30" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_30 !== null && rowData.temp_30 !== undefined ? rowData.temp_30 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_35') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_35" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_35 !== null && rowData.temp_35 !== undefined ? rowData.temp_35 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_40') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_40" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_40 !== null && rowData.temp_40 !== undefined ? rowData.temp_40 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_45') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_45" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_45 !== null && rowData.temp_45 !== undefined ? rowData.temp_45 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_50') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_50" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_50 !== null && rowData.temp_50 !== undefined ? rowData.temp_50 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'temp_55') {
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="number" [(ngModel)]="rowData.temp_55" class="w-full text-center" step="0.1">
            </ng-template>
            <ng-template pTemplate="output">
              {{ rowData.temp_55 !== null && rowData.temp_55 !== undefined ? rowData.temp_55 : '-' }}
            </ng-template>
          </p-cellEditor>
          } @else if (col.field === 'acciones') {
          <div class="flex items-center justify-center gap-2">
            <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" text rounded
              severity="secondary" (click)="onRowEditInit(rowData)" pTooltip="Editar" tooltipPosition="top">
            </button>

            <button *ngIf="editing" pButton pRipple type="button" icon="pi pi-check" text rounded severity="success"
              (click)="onRowEditSave(rowData, rowIndex, $event)" pTooltip="Guardar" tooltipPosition="top">
            </button>

            <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" text rounded
              severity="danger" (click)="onRowEditCancel(rowData, rowIndex)" pTooltip="Cancelar" tooltipPosition="top">
            </button>
          </div>
          } @else {
          {{ rowData[col.field] }}
          }
        </td>
        }
      </tr>
    </ng-template>
  </p-table>

  @if (!dataCalentamiento || dataCalentamiento.length === 0) {
  <p class="text-gray-400 text-center italic mt-4">No hay datos para mostrar</p>
  }
</div>
