<div class="card flex justify-center">
  <p-dialog [header]="'Detalles de Visita No. ' + (visitaData?.no_visita || '')" [modal]="true" [(visible)]="visible"
    [style]="{ width: '90rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [maximizable]="true"
    (onHide)="closeDialog()" [draggable]="false">

    <p-toast position="top-right" key="tr-secondary" />

    @if (loading) {
    <div
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300">
      <p-progress-spinner strokeWidth="8" fill="transparent" animationDuration="2s"
        [style]="{ width: '70px', height: '70px' }"></p-progress-spinner>
    </div>
    }

    <!-- Tabla de condiciones -->
    <table-condiciones />

    <!-- Sección de observaciones y recomendaciones -->
    <div class="observaciones-recomendaciones-section mt-6">
      <div class="grid grid-cols-2 gap-6">
        <!-- Observaciones -->
        <div class="textarea-col">
          <label class="textarea-label font-bold">OBSERVACIONES: <span class="required">*</span></label>
          <textarea
            pInputTextarea
            [(ngModel)]="observaciones"
            name="observaciones"
            rows="8"
            cols="30"
            class="w-full"
            placeholder="Escriba sus observaciones aquí..."
            (ngModelChange)="onFieldChange('observaciones', $event)"
            [class.ng-invalid]="formErrors['observaciones']">
          </textarea>
          <small class="error-message" *ngIf="formErrors['observaciones']">
            {{ formErrors['observaciones'] }}
          </small>
        </div>

        <!-- Recomendaciones y/o Educación -->
        <div class="textarea-col">
          <label class="textarea-label font-bold">RECOMENDACIONES Y/O EDUCACION: <span class="required">*</span></label>
          <textarea
            pInputTextarea
            [(ngModel)]="recomendacionesEducacion"
            name="recomendacionesEducacion"
            rows="8"
            cols="30"
            class="w-full"
            placeholder="Escriba las recomendaciones y/o educación aquí..."
            (ngModelChange)="onFieldChange('recomendacionesEducacion', $event)"
            [class.ng-invalid]="formErrors['recomendacionesEducacion']">
          </textarea>
          <small class="error-message" *ngIf="formErrors['recomendacionesEducacion']">
            {{ formErrors['recomendacionesEducacion'] }}
          </small>
        </div>
      </div>
    </div>

    <!-- Sección de firmas -->
    <div class="firmas-section mt-6">
      <div class="grid grid-cols-2 gap-6">
        <!-- Firma Usuaria -->
        <div class="firma-col">
          <label class="firma-label font-bold">FIRMA USUARIA: <span class="required">*</span></label>
          <div class="signature-container">
            <canvas
              #canvasUsuaria
              width="350"
              height="120"
              class="signature-canvas"
              [class.canvas-invalid]="formErrors['firmaUsuaria']">
            </canvas>
            <div class="signature-controls mt-2 flex gap-2">
              <button
                type="button"
                (click)="clearFirmaUsuaria()"
                class="clear-button">
                Limpiar
              </button>
            </div>
          </div>
          <small class="error-message" *ngIf="formErrors['firmaUsuaria']">
            {{ formErrors['firmaUsuaria'] }}
          </small>
        </div>

        <!-- Firma de quien realiza la visita -->
        <div class="firma-col">
          <label class="firma-label font-bold">FIRMA DE QUIEN REALIZA LA VISITA: <span class="required">*</span></label>
          <div class="signature-container">
            <canvas
              #canvasVisitante
              width="350"
              height="120"
              class="signature-canvas"
              [class.canvas-invalid]="formErrors['firmaVisitante']">
            </canvas>
            <div class="signature-controls mt-2 flex gap-2">
              <button
                type="button"
                (click)="clearFirmaVisitante()"
                class="clear-button">
                Limpiar
              </button>
            </div>
          </div>
          <small class="error-message" *ngIf="formErrors['firmaVisitante']">
            {{ formErrors['firmaVisitante'] }}
          </small>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-end gap-4 mt-8 pr-0">
      <button
        pButton
        type="button"
        label="Guardar"
        icon="pi pi-save"
        class="guardar-btn"
        (click)="onGuardar()">
      </button>
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        class="cancelar-btn"
        (click)="closeDialog()">
      </button>
    </div>

  </p-dialog>
</div>
