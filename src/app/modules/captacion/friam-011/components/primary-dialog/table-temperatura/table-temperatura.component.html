<p-toast position="top-right" key="tr" />

<p-table #table [value]="dataTable" [scrollable]="true" scrollHeight="300px" [tableStyle]="{ 'min-width': '50rem' }"
  [columns]="headerTableTemperatura" editMode="row" dataKey="id">
  <ng-template #header let-columns>
    <tr>
      @for (col of columns; track $index) {
      <th class="grid-lines" [ngStyle]="{ 'min-width': col.width }">
        {{ col.header }}
      </th>
      }
    </tr>
  </ng-template>
  <ng-template #body let-rowData let-columns="columns" let-editing="editing" let-ri="rowIndex">
    <tr [pEditableRow]="rowData">
      @for (col of columns; track $index) {
      @if (col.field != "acciones") {
      <td>
        <p-cellEditor>
          <ng-template #input>
            @switch (col.tipo) {
            @case ("number") {
              @if (col.field === 't_salida' || col.field === 't_llegada') {
                <input [type]="col.tipo" pInputText [(ngModel)]="rowData[col.field]" [disabled]="true"
                  [ngClass]="{ 'ng-invalid ng-dirty': isFieldInvalid(col.field, rowData) }" />
              }
              @else {
                <input [type]="col.tipo" pInputText [(ngModel)]="rowData[col.field]" 
                  [ngClass]="{ 'ng-invalid ng-dirty': isFieldInvalid(col.field, rowData) }" />
              }
            }
            @case ("time") {
            <p-datepicker appendTo="body" [(ngModel)]="rowData[col.field]" [iconDisplay]="'input'" [showIcon]="true"
              inputId="icondisplay" [timeOnly]="true"
              [ngClass]="{ 'ng-invalid ng-dirty': isFieldInvalid(col.field, rowData) }" />
            }
            }
          </ng-template>
          <ng-template #output>
            @if(col.tipo == "time"){
            <p-datepicker appendTo="body" [(ngModel)]="rowData[col.field]" [iconDisplay]="'input'" [showIcon]="true"
              inputId="icondisplay" [timeOnly]="true" [disabled]="true" />
            }@else {
              {{rowData[col.field]}}
            }
          </ng-template>
        </p-cellEditor>
      </td>
      }
      @else if (col.field === "acciones") {
      <td>
        <div class="flex items-center justify-center gap-2">
          <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" text rounded
            severity="secondary" (click)="onRowEditInit(rowData)"></button>

          <button *ngIf="editing" pButton pRipple type="button" icon="pi pi-check" text rounded severity="success"
            (click)="onRowEditSave(rowData,ri,$event)"></button>

          <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" text rounded
            severity="danger" (click)="onRowEditCancel(rowData, ri)"></button>
        </div>
      </td>
      }

      }
    </tr>
  </ng-template>
</p-table>

<div *ngIf="!dataTable" class="p-4 text-center text-gray-500">
  No hay datos disponibles
</div>